<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">
    
    <changeSet id="1656075873551-3" author="Dmitry Mishnev">
        <dropAllForeignKeyConstraints baseTableName="orders"/>
        <dropAllForeignKeyConstraints baseTableName="task"/>
        <dropAllForeignKeyConstraints baseTableName="worker"/>
        <dropAllForeignKeyConstraints baseTableName="price"/>
        <dropAllForeignKeyConstraints baseTableName="equipment"/>
    </changeSet>

    <changeSet id="1656075873551-4" author="Dmitry Mishnev">
        <renameColumn tableName="orders" oldColumnName="client" newColumnName="client_id"/>
        <renameColumn tableName="orders" oldColumnName="closingDate" newColumnName="closing_date"/>
        <renameColumn tableName="task" oldColumnName="order" newColumnName="order_id"/>
        <renameColumn tableName="task" oldColumnName="worker" newColumnName="worker_id"/>
        <renameColumn tableName="task" oldColumnName="job" newColumnName="job_id"/>
        <renameColumn tableName="task" oldColumnName="creator_worker" newColumnName="creator_worker_id"/>
        <renameColumn tableName="worker" oldColumnName="user" newColumnName="user_id"/>
        <renameColumn tableName="price" oldColumnName="job" newColumnName="job_id"/>
        <renameColumn tableName="equipment" oldColumnName="client" newColumnName="client_id"/>
        <renameColumn tableName="equipment" oldColumnName="address" newColumnName="address_id"/>
    </changeSet>

    <changeSet id="1656075873551-5" author="Dmitry Mishnev">
        <addForeignKeyConstraint baseTableName="orders" baseColumnNames="client_id" constraintName="order_client"
                                 referencedTableName="client"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="task" baseColumnNames="order_id" constraintName="task_order"
                                 referencedTableName="orders"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="task" baseColumnNames="worker_id" constraintName="task_worker"
                                 referencedTableName="worker"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="task" baseColumnNames="job_id" constraintName="task_job"
                                 referencedTableName="job"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="task" baseColumnNames="creator_worker_id" constraintName="task_creator_worker"
                                 referencedTableName="worker"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="worker" baseColumnNames="user_id" constraintName="worker_user"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="price" baseColumnNames="job_id" constraintName="price_job"
                                 referencedTableName="job"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="equipment" baseColumnNames="client_id" constraintName="equipment_client"
                                 referencedTableName="client"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="equipment" baseColumnNames="address_id" constraintName="equipment_address"
                                 referencedTableName="address"
                                 referencedColumnNames="id"/>
    </changeSet>
</databaseChangeLog>